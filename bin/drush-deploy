#!/usr/bin/env ruby

require 'capistrano/cli'
require 'drush_deploy/paths'

aliases,args = ARGV.partition {|a| a =~ /^@./}

unless aliases.empty?
  args = ['--set-before', 'cmdline_target='+aliases.map {|a| a[1..-1] }.join(',')] + args
end

args = [ '--default-config', '--file', DrushDeploy::Paths.recipe('bootstrap')] + args

cli = Capistrano::CLI.parse(args)
if cli.options[:actions].empty?
  args << 'deploy'
  cli = Capistrano::CLI.parse(args)
end
cli.execute!
